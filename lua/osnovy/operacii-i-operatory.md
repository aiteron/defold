---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Операции и операторы

В Lua допустимы следующие операции:

## Арифметические операции

* \+ (сложение)
* \- (вычитание)
* \* (умножение)
* / (деление)
* ^ (возведение в степень)
* % (остаток от деления)

## Операции сравнения

* \== (равно)
* \~= (не равно)
* < (меньше)
* \> (больше)
* <= (меньше или равно)
* \>= (больше или равно)

{% hint style="info" %}
Lua сравнивает таблицы и userdata по ссылке, то есть два таких значения считаются равными, только если они являются одним и тем же объектом.\*

\
Операции порядка (<,>,<=,>=) можно применять лишь к двум числам или двум строкам.\*\
\
\*С помощью метатаблиц можно переопределить функции сравнение/порядка для таблиц. Подробнее читайте в главе про [метатаблицы](metatablicy-i-metametody.md).&#x20;
{% endhint %}

## Логические операции

Логические операции — это and, or и not. Как и управляющие структуры, все логические операции трактуют false и nil как ложные, а все остальные — как истинные значения.

Операция and возвращает свой первый аргумент, если он ложный, иначе она возвращает свой второй аргумент. Операция or возвращает свой первый аргумент, если он не ложный; иначе она возвращает свой второй аргумент:

```lua
print(4 and 5)        --> 5
print(nil and 13)     --> nil
print(false and 13)   --> false
print(4 or 5)         --> 4
print(false or 5)     --> 5
```

Обе операции, and и or, используют сокращенное вычисление, то есть они вычисляют свой второй операнд только при необходимости.

{% hint style="success" %}
Полезной идиомой Lua является:

```lua
x = x or v
```

Которая эквивалентна:

```lua
if not x then x = v end
```

То есть значение x по умолчанию устанавливается равным значению v, если x не определен (при условии, что x не равен false).
{% endhint %}

{% hint style="success" %}
Еще одна полезная идиома:

```lua
x = a and b or c
```

Она работает как аналог тернарный оператор из других языков (но только при условии что b не ложно).

```lua
max = (x > y) and x or y    -- выбор максимума из двух чисел
```

(Скобки выражение с оператором <mark style="color:red;">and</mark> брать не нужно, т.к. <mark style="color:red;">and</mark> имеет более высокий приоритет)
{% endhint %}

Операция <mark style="color:red;">not</mark> всегда возвращает булево значение:

```lua
print(not nil)        --> true
print(not false)      --> true
print(not 0)          --> false
print(not not 1)      --> true
print(not not nil)    --> false
```

## Конкатенация

Lua обозначает операцию конкатенации строк как .. (две точки). Если один из операндов является числом, то Lua переведет его в строку.

```lua
print("Hello" .. "World")    --> Hello World
print(0 .. 1)                --> 01
print(000 .. 01)             --> 01
```

{% hint style="warning" %}
Помните, что строки в Lua являются неизменяемыми значениями. Операция конкатенации всегда создает новую строку, не изменяя свои операнды:

```lua
a = "Hello"
print(a .. " World")    --> Hello World
print(a)                --> Hello
```
{% endhint %}

## Операция длины

Операция длины работает со строками и таблицами. Со строками она дает количество байт в строке. С таблицами она возвращает длину представленной ими последовательности.

{% hint style="info" %}
Последовательность — это таблица, где числовые ключи образуют множество 1,...,n для некоторого n.

<mark style="background-color:red;">TODO!!!</mark>
{% endhint %}

Если вам нужно обрабатывать списки с дырами, то вы должны хранить их длину явным образом где-то еще.

## Конструкторы таблиц

Конструкторы — это выражения, которые создают и инициализируют таблицы.

```lua
a = {}    -- простейший конструктор (инициализирует пустую таблицу)

b = {"one", "two", "three"}    -- конструктор, который инициализирует список
print(b[1])    --> "one"
print(b[2])    --> "two"
print(b[3])    --> "three"

c = {x=10, y=20}    -- конструктор, который инициализирует таблицу с записями
print(c.x)          --> 10
print(c["y"])       --> 20

-- Мы можем смешивать эти два стиля инициализации в одном конструкторе:
polyline = {color="blue",
            thickness=2,
            npoints=4,
            {x=0, y=0},
            {x=-10, y=0},
            {x=-10, y=1},
            {x=0, y=7}
           }
print(polyline.color)  --> blue
print(polyline[4].y)   --> 7
```

{% hint style="warning" %}
У этих форм конструктора есть свои ограничения. Например, вы не можете инициализировать поля отрицательными индексами или строковыми индексами, которые не являются правильными идентификаторами. Для этих целей существует более общий формат конструктора:

```lua
i = -20
test = {["+"] = "add", [i+5] = "number"}
print(test["+"])    --> add
print(test[-15])    --> number
```
{% endhint %}

## Операторы присваивания

Присваивание — это базовое средство изменения значения переменной или поля таблицы:

```lua
a = "hello" .. " " .. "world"
t.n = t.n + 1
```

Lua позволяет осуществлять множественное присваивание, которое присваивает список значений списку переменных за один шаг.

```lua
a, b = 10, "DUCK"
print(a)    --> 10
print(b)    --> DUCK
```

Во множественном присваивании Lua сперва вычисляет все значения и только затем выполняет присваивания. Поэтому мы можем использовать множественное присваивание, чтобы поменять местами два значения:

```lua
x, y = y, x
a[i], a[j] = a[j], a[i]
```

Lua всегда приводит количество значений к количеству переменных: когда список значений короче списка переменных, дополнительные переменные получают в качестве своих значений nil; когда длиннее список значений, дополнительные значения просто отбрасываются:

```lua
a, b, c = 0, 1
print(a, b, c) --> 0 1 nil
a, b = a+1, b+1, b+2 -- значение b+2 игнорируется
print(a, b) --> 1 2
a, b, c = 0
print(a, b, c) --> 0 nil nil
```

{% hint style="warning" %}
Будьте внимательны когда инициализируете набор переменных с помощью множественного присваивания. Для инициализации набора нужно предоставить значение для каждой из них:

```lua
a, b, c = 0, 0, 0
print(a, b, c)    --> 0 0 0
```
{% endhint %}

{% hint style="success" %}
Чаще всего множественное присваивание используется чтобы поменять переменные местами и при получении нескольких значений при вызове функции.

```lua
a, b = f()
```

Подробнее про функции читайте на странице [функции](funkcii.md).
{% endhint %}















## Полезное

{% hint style="info" %}
Предпочтительнее сразу задавать значения таблицы в конструкторе т.к. Lua сразу создаст таблицу нужного размера. В ином случае (если в пустую таблицу добавлять элементы по одному) Lua при переполнении размера таблицы будет выделять новый участок памяти и переносить туда первоначальные элементы и после добавлять новые элементы.
{% endhint %}

{% hint style="info" %}
Вы всегда можете поставить запятую после последней записи. Эти замыкающие запятые необязательны, но всегда допустимы:

```lua
a = {[1]="red", [2]="green", [3]="blue",}
```

Также вы можете использовать точку с запятой вместо запятой:

```lua
b = {x=10, y=45; "one", "two", "three"}
```
{% endhint %}



{% hint style="info" %}
Приоритет операций в LuaВ языке Lua выполнение операций осуществляется в соответствии со следующим приоритетом (в порядке убывания):

1. ^
2. not # - (унарный)
3. \* / %
4. \+ -
5. ..
6. < > <= >= \~= ==
7. and
8. or

<mark style="color:green;">**Когда сомневаетесь, всегда используйте круглые скобки. Это легче, чем заглядывать в справочник, так как при перечитывании кода у вас вновь могут возникнуть те же сомнения.**</mark>
{% endhint %}
